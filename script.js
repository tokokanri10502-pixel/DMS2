// DMS 問題集データ (自動生成)
const QUIZ_DATA = [
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q1",
    "text": "Googleの「NotebookLM」の最大の特徴として、正しいものはどれか？",
    "options": [
      "ネット上の最新情報を自動で毎日要約して届けてくれる機能",
      "アップロードした「自分の資料（ソース）」に基づいた分析や回答に特化している点",
      "プログラミングコードを入力するだけで、自動でアプリを完成させる機能",
      "写真や動画をアップロードすると、自動でSNS用のバナー画像を作成する点"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q2",
    "text": "NotebookLMで、資料を読み込ませた後に「よくある質問」や「学習ガイド」などを自動作成してくれる機能を何と呼ぶか？",
    "options": [
      "ノートブックガイド",
      "プロンプト集",
      "ソースエディタ",
      "ナレッジグラフ"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q3",
    "text": "生成AIに対して、自分の意図した回答を引き出すために入力する「指示文」を何と呼ぶか？",
    "options": [
      "クエリ",
      "プロンプト",
      "コマンド",
      "ログ"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q4",
    "text": "AIに指示を出す際、単に「書いて」と言うより、「あなたはプロの編集者です」と役割を与える手法を何と呼ぶか？",
    "options": [
      "ターゲティング",
      "フィルタリング",
      "デバッグ",
      "ロール（役割）付与"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q5",
    "text": "AIが「もっともらしい嘘」を自信満々に回答してしまう現象を指す用語はどれか？",
    "options": [
      "ハルシネーション",
      "バズ",
      "フリーズ",
      "シャドーIT"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q6",
    "text": "Antigravity（アンチグラビティ）で利用できるモデル「Nano Banana」の主な得意分野はどれか？",
    "options": [
      "数時間に及ぶ長尺動画の内容をすべて正確に書き起こすこと",
      "高度な物理シミュレーションや、複雑なプログラミングの構築",
      "非常に高速なレスポンスで、短文の添削や簡単な定型業務をこなすこと",
      "プロレベルの高品質なイラストや人物写真を生成すること"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q7",
    "text": "ChatGPT（OpenAI）において、特定の業務に合わせてカスタマイズした「自分専用のAI」を作成できる機能はどれか？",
    "options": [
      "Plug-in",
      "Advanced Voice",
      "GPTs",
      "DALL-E"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q8",
    "text": "ChatGPTなどの大規模言語モデル（LLM）が、膨大な文章から重要なポイントを抜き出す作業を何と呼ぶか？",
    "options": [
      "スキャン",
      "要約（サマリー）",
      "フィルタリング",
      "アーカイブ"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q9",
    "text": "Antigravityのようなツールで、異なる特徴を持つ複数のAI（Pro系やFlash系など）を切り替えて使う主な理由はどれか？",
    "options": [
      "処理速度、回答精度、利用コスト（トークン）のバランスを最適化するため",
      "1つのAIでは1時間に1回しか質問ができないという制限があるため",
      "AIごとに対応している言語（日本語のみ、英語のみ等）が厳密に分かれているため",
      "パソコンのメーカー（AppleかMicrosoftか）によって使えるAIが異なるため"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第1章：生成AI・主要ツール編（AI活用を自分ごとに）",
    "id": "Q10",
    "text": "生成AIが作成した文章を社外資料に活用する際、品質管理の観点で「最も重要」とされるプロセスはどれか？",
    "options": [
      "AIにさらに長い文章を書かせて情報を増やすこと",
      "別の複数のAIに同じ質問をして、回答を多数決で決めること",
      "印刷して、フォントの見た目が綺麗かどうかを確認すること",
      "内容に誤りがないか、人間の目による事実確認と校正を行うこと"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q11",
    "text": "Webサイトの通信を暗号化し、第三者による盗聴を防ぐ仕組み（URLがhttpsで始まるもの）は？",
    "options": [
      "SEO対策",
      "SSL/TLS通信",
      "DNSルーティング",
      "FTP転送"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q12",
    "text": "複数のシステムを、1つのIDとパスワードでログインして利用できる仕組みは？",
    "options": [
      "VPN",
      "二段階認証",
      "エンドツーエンド暗号化",
      "シングルサインオン（SSO）"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q13",
    "text": "スマホやPCなど、端末の画面サイズに合わせてレイアウトが自動で最適化される手法は？",
    "options": [
      "レスポンシブデザイン",
      "パララックスデザイン",
      "フラットデザイン",
      "アクセシビリティ"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q14",
    "text": "インターネット上の機器を識別するために割り当てられる「ネットワーク上の住所」は？",
    "options": [
      "MACアドレス",
      "IPアドレス",
      "ドメイン名",
      "サブネットマスク"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q15",
    "text": "次回訪問時の表示を高速化するために、ブラウザがデータを一時的に保存する仕組みは？",
    "options": [
      "Cookie",
      "アーカイブ",
      "キャッシュ",
      "バックアップ"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q16",
    "text": "テレワーク先などから安全に社内システムへ接続するための仮想専用線技術は？",
    "options": [
      "VPN",
      "FTP",
      "DNS",
      "LAN"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q17",
    "text": "パソコンやスマホの土台となる「基本ソフトウェア（WindowsやiOSなど）」の総称は？",
    "options": [
      "ブラウザ",
      "ミドルウェア",
      "アンチウイルス",
      "OS（オペレーティングシステム）"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q18",
    "text": "ブラウザ等に後から便利な機能を追加するための小さなプログラムの総称は？",
    "options": [
      "ドライバ",
      "パッチ",
      "プラグイン（拡張機能）",
      "ファームウェア"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q19",
    "text": "ネット経由でソフトウェアの機能を月額課金などで利用する形態（Zoom等）は？",
    "options": [
      "SaaS（サース）",
      "オンプレミス",
      "ローカルホスト",
      "イントラネット"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第2章：ITインフラ・基礎知識編（デジタルの土台）",
    "id": "Q20",
    "text": "ウイルスなど、デバイスに悪意のある動作をさせるソフトウェアの総称は？",
    "options": [
      "スパム",
      "ファイアウォール",
      "トラッキング",
      "マルウェア"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q21",
    "text": "デザイン作業の前に作成する、画面のレイアウトやボタン配置を決めた「設計図」は？",
    "options": [
      "モックアップ",
      "プロトタイプ",
      "ワイヤーフレーム",
      "サイトマップ"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q22",
    "text": "専門知識がなくても、管理画面からテキストを登録してWebサイトを更新できるシステムは？",
    "options": [
      "CRM",
      "MA",
      "SFA",
      "CMS（コンテンツ管理システム）"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q23",
    "text": "ユーザーが目にする画面の「見た目や操作性」を指す用語は？",
    "options": [
      "UI（ユーザーインターフェース）",
      "UX（ユーザーエクスペリエンス）",
      "CX（カスタマーエクスペリエンス）",
      "DX（デジタルトランスフォーメーション）"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q24",
    "text": "ユーザーがサービスを利用して得られる「体験や満足度」の総称は？",
    "options": [
      "UI",
      "PV",
      "CV",
      "UX（ユーザーエクスペリエンス）"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q25",
    "text": "ユーザーの入力内容や訪問履歴を、ブラウザに一時的に保存させる仕組み（ファイル）は？",
    "options": [
      "セッション",
      "Cookie（クッキー）",
      "キャッシュ",
      "トークン"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q26",
    "text": "Webページの「構造」を定義するHTMLに対し、「装飾」を指定する言語は？",
    "options": [
      "CSS",
      "Java",
      "PHP",
      "SQL"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q27",
    "text": "広告のリンク先となるページ（LP）を改善し、お問い合わせ率を高める施策は？",
    "options": [
      "SEO",
      "EFO",
      "LPO（ランディングページ最適化）",
      "CRO"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q28",
    "text": "商品購入や問い合わせなど、Webサイトにおける「最終的な成果」を指す言葉は？",
    "options": [
      "インプレッション",
      "クリック",
      "コンバージョン（CV）",
      "リーチ"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q29",
    "text": "1つの商品を売ることに特化した、縦長のWebサイトを何と呼ぶか？",
    "options": [
      "コーポレートサイト",
      "LP（ランディングページ）",
      "ポータルサイト",
      "ECサイト"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第3章：Web制作・マーケティング編（現場で使う用語）",
    "id": "Q30",
    "text": "検索結果で自社サイトを上位（目立つ場所）に表示させるための改善施策は？",
    "options": [
      "SEO（検索エンジン最適化）",
      "SEM",
      "MEO",
      "LPO"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q31",
    "text": "広告がユーザーの画面に「表示された回数」を示す指標は？",
    "options": [
      "リーチ",
      "クリック",
      "インプレッション（IMP）",
      "エンゲージメント"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q32",
    "text": "広告を見た人のうち、実際にクリックした人の割合を示す指標は？",
    "options": [
      "CTR（クリック率）",
      "CVR（コンバージョン率）",
      "CPC（クリック単価）",
      "CPA（顧客獲得単価）"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q33",
    "text": "1回のコンバージョンを獲得するのにかかった広告費用のことは？",
    "options": [
      "CPC",
      "CPA（顧客獲得単価）",
      "CPM",
      "ROAS"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q34",
    "text": "検索したキーワードに連動して検索結果の上部に出るテキスト広告は？",
    "options": [
      "ディスプレイ広告",
      "動画広告",
      "リスティング広告",
      "SNS広告"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q35",
    "text": "一度サイトに来たユーザーを、別のサイトでも追いかけて表示する広告は？",
    "options": [
      "リスティング広告",
      "アフィリエイト広告",
      "ネイティブ広告",
      "リターゲティング広告"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q36",
    "text": "サイトを訪問したユーザーが、1ページ目だけを見て帰ってしまった割合は？",
    "options": [
      "離脱率",
      "直帰率",
      "回遊率",
      "クリック率"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q37",
    "text": "サイト内のページが見られた「延べ回数」を指す指標は？",
    "options": [
      "UU",
      "セッション",
      "PV（ページビュー）",
      "リーチ"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q38",
    "text": "投資した広告費に対して、どれだけの「売上」を得られたかを示す指標は？",
    "options": [
      "ROI",
      "CPA",
      "LTV",
      "ROAS（広告費用対効果）"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q39",
    "text": "2種類のデザインを同時に配信し、どちらが成果が出るか比較する検証は？",
    "options": [
      "ストレステスト",
      "ユーザビリティテスト",
      "A/Bテスト",
      "単体テスト"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第4章：広告・分析編（数字を読み解く）",
    "id": "Q40",
    "text": "最終目標達成のための「中間目標（チェックポイント）」となる数値は？",
    "options": [
      "KGI",
      "KPI（重要業績評価指標）",
      "OKR",
      "MBO"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q41",
    "text": "デジタルを活用してビジネスモデルを根本から変革し、競争優位を確立することは？",
    "options": [
      "デジタイゼーション",
      "DX（デジタルトランスフォーメーション）",
      "RPA",
      "クラウド化"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q42",
    "text": "ソフトウェアを買い切るのではなく、月額定額などで利用する課金モデルは？",
    "options": [
      "フリーミアム",
      "従量課金",
      "サブスクリプション",
      "クラウドファンディング"
    ],
    "answerIndex": 2
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q43",
    "text": "顧客の基本情報や対応履歴を一元管理する「顧客関係管理システム」は？",
    "options": [
      "SFA",
      "MA",
      "ERP",
      "CRM"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q44",
    "text": "短い期間で開発とテストを繰り返し、柔軟に仕様変更に対応する手法は？",
    "options": [
      "ウォーターフォール開発",
      "アジャイル開発",
      "ノーコード開発",
      "スクラッチ開発"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q45",
    "text": "「内側も疑う」ことを前提とし、常に認証を行う最新のセキュリティ概念は？",
    "options": [
      "ファイアウォール",
      "ゼロトラスト",
      "エンドポイント",
      "多要素認証"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q46",
    "text": "会社が許可していない個人のツールを、従業員が勝手に業務で使うリスクは？",
    "options": [
      "テレワーク",
      "BYOD",
      "アウトソーシング",
      "シャドーIT"
    ],
    "answerIndex": 3
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q47",
    "text": "会議をスムーズに進めるための「議題・進行表」を何と呼ぶか？",
    "options": [
      "アジェンダ",
      "プロトコル",
      "ログ",
      "アーカイブ"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q48",
    "text": "仕事を特定の担当者に割り当てたり、任命したりすることを何と呼ぶか？",
    "options": [
      "サイン",
      "アサイン",
      "ジョイン",
      "タスク"
    ],
    "answerIndex": 1
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q49",
    "text": "言った言わないを防ぐための「客観的な証拠・裏付け」を指す言葉は？",
    "options": [
      "エビデンス",
      "ガイドライン",
      "マニュアル",
      "ログ"
    ],
    "answerIndex": 0
  },
  {
    "chapter": "第5章：トレンド・戦略・セキュリティ編",
    "id": "Q50",
    "text": "情報を正しく理解し、安全・効果的に使いこなす基礎能力のことは？",
    "options": [
      "プログラミング",
      "タイピング",
      "リテラシー",
      "アナリティクス"
    ],
    "answerIndex": 2
  }
];

let currentQuestionIndex = 0;
let failCount = 0; // 現在の問題に対する間違い回数
let correctCount = 0; // 1回目で正解した問題数
const chapterStats = {};

document.addEventListener('DOMContentLoaded', () => {
    QUIZ_DATA.forEach(q => {
        if (!chapterStats[q.chapter]) {
            chapterStats[q.chapter] = { total: 0, correct: 0 };
        }
        chapterStats[q.chapter].total++;
    });
    renderQuestion(currentQuestionIndex);
});

function renderQuestion(index) {
    const container = document.getElementById('quiz-container');
    container.innerHTML = '';
    
    if (index >= QUIZ_DATA.length) {
        showResult();
        return;
    }

    const q = QUIZ_DATA[index];
    failCount = 0; // 新しい問題の開始時にリセット
    
    const card = document.createElement('div');
    card.className = 'quiz-card fade-in';

    const header = document.createElement('div');
    header.className = 'quiz-header';
    header.innerHTML = `<span class="chapter-badge">${q.chapter}</span>
                        <h2>${q.id}. ${q.text}</h2>`;
    
    card.appendChild(header);

    const optionsList = document.createElement('div');
    optionsList.className = 'options-list';
    
    q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        // 'ア〜エ' を '1〜4' に変換
        btn.innerHTML = `<span class="option-number">${idx + 1}</span> ${opt}`;
        btn.onclick = () => handleAnswer(idx, q.answerIndex, btn);
        optionsList.appendChild(btn);
    });
    
    card.appendChild(optionsList);
    
    const feedback = document.createElement('div');
    feedback.id = 'feedback-area';
    feedback.className = 'feedback';
    card.appendChild(feedback);

    container.appendChild(card);
    updateProgress(index + 1, QUIZ_DATA.length);
}

function handleAnswer(selectedIndex, correctIndex, btnElement) {
    const feedback = document.getElementById('feedback-area');
    
    // Disable buttons temporarily
    const buttons = document.querySelectorAll('.option-btn');
    buttons.forEach(btn => btn.disabled = true);
    
    if (selectedIndex === correctIndex) {
        // 1回目の選択で正解した場合のみカウントアップ
        if (failCount === 0) {
            correctCount++;
            chapterStats[QUIZ_DATA[currentQuestionIndex].chapter].correct++;
        }
        showOverlay('circle');
        btnElement.classList.add('correct-answer');
        feedback.innerHTML = '<span class="correct-text">正解！</span> 次の問題へ進みます...';
        feedback.classList.remove('incorrect-text');
        feedback.classList.add('correct-text');
        
        setTimeout(() => {
            currentQuestionIndex++;
            renderQuestion(currentQuestionIndex);
        }, 1200);
        
    } else {
        failCount++;
        btnElement.classList.add('wrong-answer');
        
        if (failCount < 2) {
            showOverlay('cross');
            const remaining = 2 - failCount;
            feedback.innerHTML = `<span class="incorrect-text">不正解！ 残り${remaining}回挑戦できます。</span>`;
            
            setTimeout(() => {
                buttons.forEach(btn => btn.disabled = false);
            }, 1000);
        } else {
            showOverlay('cross');
            feedback.innerHTML = '<span class="incorrect-text">2回間違えました。正解は <strong>' + (correctIndex + 1) + '</strong> です。次の問題へ進みます...</span>';
            buttons[correctIndex].classList.add('correct-answer'); // highlight correct
            
            setTimeout(() => {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            }, 3000);
        }
    }
}

function showOverlay(type) {
    const overlay = document.getElementById('overlay');
    const circle = document.getElementById('circle-mark');
    const cross = document.getElementById('cross-mark');
    
    overlay.style.display = 'flex';
    circle.style.display = 'none';
    cross.style.display = 'none';
    
    if (type === 'circle') {
        circle.style.display = 'block';
    } else {
        cross.style.display = 'block';
    }
    
    overlay.classList.add('show-anim');
    
    setTimeout(() => {
        overlay.classList.remove('show-anim');
        overlay.style.display = 'none';
    }, 800);
}

function updateProgress(current, total) {
    const progressEl = document.getElementById('progress-text');
    const barEl = document.getElementById('progress-bar-fill');
    if(progressEl) progressEl.textContent = `第 ${current} 問 / 全 ${total} 問`;
    if(barEl) barEl.style.width = `${(current / total) * 100}%`;
}

function showResult() {
    const container = document.getElementById('quiz-container');
    const total = QUIZ_DATA.length;
    const percentage = Math.round((correctCount / total) * 100);
    
    // 円グラフのHTML生成
    const pieChartHtml = `
        <div style="display: flex; justify-content: center; margin: 1.5rem 0;">
            <div style="
                width: 140px;
                height: 140px;
                border-radius: 50%;
                background: conic-gradient(var(--correct-color) ${percentage}%, var(--border-color) 0);
                display: flex;
                align-items: center;
                justify-content: center;
            ">
                <div style="
                    width: 110px;
                    height: 110px;
                    background: var(--surface-color);
                    border-radius: 50%;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                ">
                    <span style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: -0.2rem;">正解率</span>
                    <span style="font-size: 1.8rem; font-weight: 800; color: var(--text-main); line-height: 1;">${percentage}<span style="font-size: 1rem;">%</span></span>
                </div>
            </div>
        </div>
    `;
    
    let chapterHtml = '<div class="chapter-results" style="margin: 2rem 0; text-align: left;">';
    for (const [chapter, stats] of Object.entries(chapterStats)) {
        const chapPercent = Math.round((stats.correct / stats.total) * 100) || 0;
        chapterHtml += `
            <div style="margin-bottom: 1rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem;">
                <div style="font-weight: bold; margin-bottom: 0.25rem; font-size: 1.1rem; color: var(--text-main);">${chapter}</div>
                <div style="display: flex; justify-content: space-between; color: var(--text-muted); font-size: 0.95rem;">
                    <span>正解数: <strong style="color: var(--text-main);">${stats.correct}</strong> / ${stats.total} 問</span>
                    <span>正解率: <strong style="color: var(--text-main);">${chapPercent}%</strong></span>
                </div>
            </div>
        `;
    }
    chapterHtml += '</div>';

    // スコアに応じてメッセージを変える
    let message = '';
    if (percentage >= 90) {
        message = '素晴らしい！ITの基礎知識はバッチリです！';
    } else if (percentage >= 70) {
        message = 'よくできました！あと少しで完璧です！';
    } else if (percentage >= 50) {
        message = '半分以上正解！復習してさらに伸ばしましょう！';
    } else {
        message = 'まだまだ伸びしろがあります！もう一度挑戦してみよう！';
    }
    container.innerHTML = `
        <div class="result-card fade-in">
            <h2>お疲れ様でした！</h2>
            <div class="score-display">
                <span class="score-number">${correctCount}</span>
                <span class="score-label"> / ${total} 問正解</span>
            </div>
            ${pieChartHtml}
            <p>${message}</p>
            ${chapterHtml}
            <button onclick="location.reload()" class="restart-btn">最初からやり直す</button>
        </div>
    `;
    const progressContainer = document.querySelector('.progress-container');
    if(progressContainer) progressContainer.style.display = 'none';
}
